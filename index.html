<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Eye Trainer Pro</title>
  
  <style>
    :root {
      --bg-color: #0f172a;
      --card-bg: #1e293b;
      --accent: #3b82f6;
      --accent-glow: rgba(59, 130, 246, 0.4);
      --text-main: #f1f5f9;
      --text-muted: #94a3b8;
      --danger: #ef4444;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    
    body {
      margin: 0;
      height: 100vh;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg-color);
      color: var(--text-main);
      overflow: hidden; /* –ë–ª–æ–∫–∏—Ä—É–µ–º —Å–∫—Ä–æ–ª–ª –≤—Å–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
      display: flex;
      flex-direction: column;
    }

    /* --- LAYOUT --- */
    .app-container {
      display: flex;
      flex-direction: column;
      height: 100%;
      padding: 16px;
      padding-top: calc(16px + env(safe-area-inset-top)); /* –û—Ç—Å—Ç—É–ø –¥–ª—è iPhone */
      padding-bottom: calc(16px + env(safe-area-inset-bottom));
    }

    /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å –∏–Ω—Ñ–æ */
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .app-title {
      font-size: 18px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .timer-badge {
      background: rgba(255,255,255,0.1);
      padding: 4px 12px;
      border-radius: 20px;
      font-feature-settings: "tnum";
      font-variant-numeric: tabular-nums;
      font-size: 14px;
    }

    /* –°—Ü–µ–Ω–∞ –∞–Ω–∏–º–∞—Ü–∏–∏ */
    .stage-container {
      flex: 1;
      position: relative;
      background: radial-gradient(circle at center, #263346 0%, #0f172a 70%);
      border-radius: 24px;
      border: 1px solid rgba(255,255,255,0.05);
      box-shadow: inset 0 0 40px rgba(0,0,0,0.5);
      overflow: hidden;
      margin-bottom: 20px;
    }

    /* –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –≥–ª–∞–∑ (—Ñ–æ–Ω) */
    .eye-bg {
      position: absolute;
      left: 50%; top: 50%;
      transform: translate(-50%, -50%);
      width: 120px; height: 120px;
      border-radius: 50%;
      background: #fff;
      box-shadow: 0 0 30px rgba(255, 255, 255, 0.1);
      display: flex; align-items: center; justify-content: center;
      transition: transform 0.2s;
    }
    .eye-iris {
      width: 60px; height: 60px;
      border-radius: 50%;
      background: radial-gradient(circle, #60a5fa, #2563eb);
      position: relative;
    }
    .eye-pupil {
      width: 24px; height: 24px;
      background: #000;
      border-radius: 50%;
      position: absolute;
      left: 50%; top: 50%;
      transform: translate(-50%, -50%); /* –ë—É–¥–µ—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω–æ JS */
    }
    .eye-reflection {
      position: absolute;
      width: 10px; height: 10px;
      background: rgba(255,255,255,0.8);
      border-radius: 50%;
      top: 12px; left: 12px;
    }

    /* –¶–µ–ª—å –¥–ª—è —Å–ª–µ–∂–µ–Ω–∏—è */
    .target-dot {
      position: absolute;
      width: 30px; height: 30px;
      background: var(--accent);
      border-radius: 50%;
      box-shadow: 0 0 20px var(--accent-glow), 0 0 10px var(--accent);
      border: 2px solid #fff;
      pointer-events: none;
      display: none; /* –°–∫—Ä—ã—Ç –ø–æ–∫–∞ –Ω–µ –∑–∞–ø—É—â–µ–Ω */
      will-change: transform;
    }

    /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
    .controls-bar {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 12px;
    }

    .btn {
      border: none;
      border-radius: 16px;
      padding: 16px 24px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.1s, opacity 0.2s;
      display: flex; align-items: center; justify-content: center; gap: 8px;
    }
    .btn:active { transform: scale(0.96); }
    
    .btn-primary {
      background: var(--accent);
      color: #fff;
      box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
    }
    .btn-danger {
      background: var(--danger);
      color: #fff;
    }
    .btn-icon {
      background: var(--card-bg);
      color: var(--text-main);
      width: 54px; 
      padding: 0;
    }

    /* --- SETTINGS SHEET (Bottom Sheet) --- */
    .overlay {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.6);
      backdrop-filter: blur(4px);
      z-index: 100;
      opacity: 0; pointer-events: none;
      transition: opacity 0.3s;
      display: flex; flex-direction: column; justify-content: flex-end;
    }
    .overlay.active { opacity: 1; pointer-events: auto; }

    .sheet {
      background: var(--card-bg);
      border-radius: 24px 24px 0 0;
      padding: 24px;
      transform: translateY(100%);
      transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
      padding-bottom: calc(24px + env(safe-area-inset-bottom));
    }
    .overlay.active .sheet { transform: translateY(0); }

    .sheet-header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 24px;
    }
    .sheet-title { font-size: 20px; font-weight: 700; margin: 0; }
    
    .setting-group { margin-bottom: 20px; }
    .setting-label {
      display: block; color: var(--text-muted);
      font-size: 13px; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.5px;
    }

    /* –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Ä–∞–¥–∏–æ-–∫–Ω–æ–ø–∫–∏ –¥–ª—è —Ä–µ–∂–∏–º–æ–≤ */
    .mode-selector {
      display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;
    }
    .mode-opt {
      background: rgba(255,255,255,0.05);
      border: 1px solid transparent;
      padding: 12px;
      border-radius: 12px;
      text-align: center;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }
    .mode-opt.active {
      background: rgba(59, 130, 246, 0.15);
      border-color: var(--accent);
      color: var(--accent);
    }

    /* –°–ª–∞–π–¥–µ—Ä—ã */
    input[type=range] {
      width: 100%; -webkit-appearance: none; background: transparent;
    }
    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      height: 24px; width: 24px;
      border-radius: 50%;
      background: #fff;
      margin-top: -10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }
    input[type=range]::-webkit-slider-runnable-track {
      width: 100%; height: 4px;
      background: rgba(255,255,255,0.2);
      border-radius: 2px;
    }

    /* –ê–Ω–∏–º–∞—Ü–∏—è –ø—É–ª—å—Å–∞—Ü–∏–∏ –¥–ª—è —Ñ–æ–∫—É—Å–∞ */
    @keyframes pulse-ring {
      0% { transform: scale(0.8); opacity: 0.5; }
      100% { transform: scale(2); opacity: 0; }
    }
    .target-dot::after {
      content: ''; position: absolute; inset: -4px;
      border-radius: 50%; border: 1px solid var(--accent);
      animation: pulse-ring 2s infinite;
    }
  </style>
</head>
<body>

<div class="app-container">
  <div class="top-bar">
    <div class="app-title">
      üëÅÔ∏è Eye Trainer
    </div>
    <div class="timer-badge" id="timerDisplay">00:00</div>
  </div>

  <div class="stage-container" id="stage">
    <div class="eye-bg" id="mainEye">
      <div class="eye-iris">
        <div class="eye-pupil" id="mainPupil">
          <div class="eye-reflection"></div>
        </div>
      </div>
    </div>
    <div class="target-dot" id="target"></div>
  </div>

  <div class="controls-bar">
    <button class="btn btn-primary" id="actionBtn">–ù–∞—á–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</button>
    <button class="btn btn-icon" id="settingsBtn">
      ‚öôÔ∏è
    </button>
  </div>
</div>

<div class="overlay" id="settingsOverlay">
  <div class="sheet">
    <div class="sheet-header">
      <h3 class="sheet-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
      <div style="cursor:pointer; padding:10px" id="closeSettings">‚úï</div>
    </div>

    <div class="setting-group">
      <span class="setting-label">–†–µ–∂–∏–º –¥–≤–∏–∂–µ–Ω–∏—è</span>
      <div class="mode-selector" id="modeContainer">
        <div class="mode-opt active" data-mode="infinity">‚ôæÔ∏è –í–æ—Å—å–º–µ—Ä–∫–∞</div>
        <div class="mode-opt" data-mode="circle">‚≠ï –ö—Ä—É–≥</div>
        <div class="mode-opt" data-mode="horizontal">‚ÜîÔ∏è –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å</div>
        <div class="mode-opt" data-mode="random">üé≤ –•–∞–æ—Å</div>
      </div>
    </div>

    <div class="setting-group">
      <span class="setting-label">–°–∫–æ—Ä–æ—Å—Ç—å</span>
      <input type="range" id="speedRange" min="1" max="5" step="0.5" value="2.5">
    </div>

    <div class="setting-group">
      <span class="setting-label">–í—Ä–µ–º—è: <span id="durVal">60</span> —Å–µ–∫</span>
      <input type="range" id="durationRange" min="15" max="180" step="15" value="60">
    </div>

    <button class="btn btn-primary" style="width:100%" id="saveBtn">–ì–æ—Ç–æ–≤–æ</button>
  </div>
</div>

<script>
  // Elements
  const stage = document.getElementById('stage');
  const target = document.getElementById('target');
  const mainEye = document.getElementById('mainEye');
  const mainPupil = document.getElementById('mainPupil');
  const actionBtn = document.getElementById('actionBtn');
  const settingsBtn = document.getElementById('settingsBtn');
  const overlay = document.getElementById('settingsOverlay');
  const closeSettings = document.getElementById('closeSettings');
  const saveBtn = document.getElementById('saveBtn');
  const timerDisplay = document.getElementById('timerDisplay');
  const modeOpts = document.querySelectorAll('.mode-opt');
  const speedRange = document.getElementById('speedRange');
  const durationRange = document.getElementById('durationRange');
  const durVal = document.getElementById('durVal');

  // State
  let state = {
    running: false,
    mode: 'infinity',
    speed: 2.5,
    duration: 60,
    startTime: 0,
    animationId: null,
    w: 0, h: 0, 
    randomPoints: [] 
  };

  // Init
  window.addEventListener('resize', updateDims);
  function updateDims() {
    state.w = stage.clientWidth;
    state.h = stage.clientHeight;
  }
  updateDims();

  // Settings Logic
  settingsBtn.onclick = () => overlay.classList.add('active');
  const closeMenu = () => overlay.classList.remove('active');
  closeSettings.onclick = closeMenu;
  saveBtn.onclick = closeMenu;
  overlay.onclick = (e) => { if(e.target === overlay) closeMenu(); };

  modeOpts.forEach(opt => {
    opt.onclick = () => {
      modeOpts.forEach(o => o.classList.remove('active'));
      opt.classList.add('active');
      state.mode = opt.dataset.mode;
    };
  });

  durationRange.oninput = () => {
    state.duration = parseInt(durationRange.value);
    durVal.innerText = state.duration;
    timerDisplay.innerText = formatTime(state.duration);
  };
  
  speedRange.oninput = () => state.speed = parseFloat(speedRange.value);

  // Main Loop
  function startTraining() {
    state.running = true;
    state.startTime = Date.now();
    
    target.style.display = 'block';
    actionBtn.textContent = '–°—Ç–æ–ø';
    actionBtn.classList.replace('btn-primary', 'btn-danger');
    settingsBtn.disabled = true;
    settingsBtn.style.opacity = 0.5;

    if(state.mode === 'random') generateRandomPath();

    loop();
  }

  function stopTraining() {
    state.running = false;
    cancelAnimationFrame(state.animationId);
    
    target.style.display = 'none';
    actionBtn.textContent = '–ù–∞—á–∞—Ç—å —Å–Ω–æ–≤–∞';
    actionBtn.classList.replace('btn-danger', 'btn-primary');
    settingsBtn.disabled = false;
    settingsBtn.style.opacity = 1;
    
    // –°–±—Ä–æ—Å –≥–ª–∞–∑–∞ –≤ —Ü–µ–Ω—Ç—Ä
    mainPupil.style.transform = `translate(-50%, -50%)`;
    timerDisplay.innerText = formatTime(state.duration);
  }

  actionBtn.onclick = () => {
    if(state.running) stopTraining();
    else startTraining();
  };

  // Helpers
  function formatTime(sec) {
    const m = Math.floor(sec / 60).toString().padStart(2, '0');
    const s = (sec % 60).toString().padStart(2, '0');
    return `${m}:${s}`;
  }

  function generateRandomPath() {
    state.randomPoints = [];
    for(let i=0; i<20; i++) {
      state.randomPoints.push({
        x: Math.random(), 
        y: Math.random()
      });
    }
  }

  function getPosition(t) {
    const w = state.w - 60;
    const h = state.h - 60;
    const cx = state.w / 2;
    const cy = state.h / 2;

    let x = cx, y = cy;

    if (state.mode === 'circle') {
      x = cx + Math.cos(t) * (w/2.5);
      y = cy + Math.sin(t) * (w/2.5); 
    } 
    else if (state.mode === 'infinity') {
      const scale = w / 2.2;
      x = cx + (scale * Math.cos(t)) / (1 + Math.sin(t)**2);
      y = cy + (scale * Math.cos(t) * Math.sin(t)) / (1 + Math.sin(t)**2);
    }
    else if (state.mode === 'horizontal') {
      x = cx + Math.sin(t) * (w/2.2);
      y = cy;
    }
    else if (state.mode === 'random') {
      // Simple interpolation between random points
      const cycleDuration = 3;
      const pIndex = Math.floor(t) % state.randomPoints.length;
      const nextIndex = (pIndex + 1) % state.randomPoints.length;
      const localT = t % 1; 
      
      // Smooth step
      const smoothT = localT * localT * (3 - 2 * localT);
      
      const p1 = state.randomPoints[pIndex];
      const p2 = state.randomPoints[nextIndex];

      x = 30 + (p1.x + (p2.x - p1.x) * smoothT) * w;
      y = 30 + (p1.y + (p2.y - p1.y) * smoothT) * h;
    }

    return {x, y};
  }

  function moveEye(targetX, targetY) {
    const rect = mainEye.getBoundingClientRect();
    const eyeCX = rect.left + rect.width/2;
    const eyeCY = rect.top + rect.height/2;

    const dx = targetX - eyeCX;
    const dy = targetY - eyeCY;
    
    const angle = Math.atan2(dy, dx);
    const dist = Math.min(12, Math.sqrt(dx*dx + dy*dy) / 10); // Limit pupil movement

    const px = Math.cos(angle) * dist;
    const py = Math.sin(angle) * dist;

    mainPupil.style.transform = `translate(calc(-50% + ${px}px), calc(-50% + ${py}px))`;
  }

  function loop() {
    if(!state.running) return;

    const now = Date.now();
    const elapsed = now - state.startTime;
    const remaining = Math.max(0, state.duration * 1000 - elapsed);
    
    // Timer update
    timerDisplay.innerText = formatTime(Math.ceil(remaining/1000));
    if(remaining <= 0) {
      stopTraining();
      return;
    }

    // Movement math
    // Speed factor: 0.001 is base time scale. 
    let speedMult = state.speed; 
    if(state.mode === 'horizontal') speedMult *= 1.5;
    
    const t = (elapsed * 0.001) * speedMult; 
    const pos = getPosition(t);

    target.style.transform = `translate(${pos.x}px, ${pos.y}px)`;
    target.style.left = '0px'; 
    target.style.top = '0px';
    target.style.transform = `translate3d(${pos.x - 15}px, ${pos.y - 15}px, 0)`;

    // Move the big eye pupil
    
    const stageRect = stage.getBoundingClientRect();
    const absX = stageRect.left + pos.x;
    const absY = stageRect.top + pos.y;
    
    moveEye(absX, absY);

    state.animationId = requestAnimationFrame(loop);
  }
  
  // Initial set
  timerDisplay.innerText = formatTime(state.duration);
</script>

</body>
</html>
